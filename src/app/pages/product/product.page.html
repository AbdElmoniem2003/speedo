<ion-header class="custom-header" *ngIf="!isloading">

  <div class="content">
    <ion-button class="no-color-button" routerLink="/cart">
      <ion-img src="../../../assets/imgs/cart.svg"></ion-img>
            @if((cartService.cartProducts?.length)){
      <span>{{cartService.cartProducts?.length}}</span>
      }
    </ion-button>

    <div>
      <ion-label> تفاصيل المنتج</ion-label>
      <ion-back-button class="no-color-button" icon="chevron-forward">
      </ion-back-button>
    </div>
  </div>
</ion-header>

<ion-content *ngIf="!isloading">

  <div class="container">

    @if(product){
    <div class="product">

      <div class="img fade-in"><img [src]="product?.image||'../../../assets/imgs/logo-icon.svg'"></div>

      <div class="prod-data fade-in">


        <div class="prod-title">
          {{product?.name}}
        </div>
        @if(product?.description){<div class="prod-desc">
          {{product?.description}}
          <span class="ion-activatable">
            <!-- <u style="cursor: pointer;">عرض المزيد</u> -->
            <ion-ripple-effect></ion-ripple-effect>
          </span>
        </div>}
        <div class="btns">

          @if(product.new){
          <span [class]="'expanded'">
            <ion-img src="../../../assets/imgs/stars.svg" slot="icon-only"></ion-img>
            جديد
          </span>
          }
          @if(product.offer){

          <span [class]="'expanded'">
            <ion-img src="../../../assets/imgs/offer-icon.svg" slot="icon-only"></ion-img>
            خصم
          </span>
          }
          @if(product.special){
          <span [class]="'expanded'">
            <ion-img src="../../../assets/imgs/trend-icon.svg" slot="icon-only"></ion-img>
            افضل مبيعا
          </span>
          }
        </div>
        <div class="price">
          <h3 style="direction: rtl;">{{product?.price - product?.discountPrice|number}} د.ع</h3>
          @if(product?.discountPrice){<h3 class="before-discount">{{product?.price|number}} د.ع</h3>}
        </div>
      </div>

      <!-- <div class="extra">
        <h5>اضافات</h5>

        <div class="colors">
          <h3>اللون</h3>
          <ion-segment [(ngModel)]="prodExtras.color">
            <ion-segment-button value="اخضر"><span></span></ion-segment-button>
            <ion-segment-button value="احمر"><span></span></ion-segment-button>
            <ion-segment-button value="ذهبي"><span></span></ion-segment-button>
          </ion-segment>
        </div>

        <div class="sizes">
          <h3>الحجم</h3>
          <ion-segment [(ngModel)]="prodExtras.size">
            <ion-segment-button value="كبير">كبير (٩٨٠د)</ion-segment-button>
            <ion-segment-button value="متوسط">متوسط (٩٨٧د)</ion-segment-button>
            <ion-segment-button value="صغير">صغير (٧٨٧د)</ion-segment-button>
          </ion-segment>
        </div>

        <ion-radio-group [allowEmptySelection]="true" (ionChange)="prodExtras.towler = !prodExtras.towler">
          <ion-radio>منشفة (٧٦٨د)</ion-radio>
        </ion-radio-group>

      </div> -->

      <div class="similar-prods" *ngIf="similarProducts">
        <section>منتجات مشابهة</section>
        <div class="prods-cards">
          @for (prod of similarProducts; track $index) {
          <div class="card fade-in">
            <div class="card-content" [routerLink]="`/product/${prod._id}`">
              <ion-img [src]="prod.image||'../../../assets/imgs/logo.png'"></ion-img>
              <p> {{prod.name}}</p>
              <div>
                <h3>{{prod.price - prod.discountPrice|number}} د.ع</h3>
              </div>
            </div>
            <ion-button>
              <ion-label>أضف للسلة</ion-label>
              <ion-img src="../../../assets/imgs/add-cart.svg"></ion-img>
            </ion-button>
            <div class="addition-btns">
              <ion-button (click)="addToFavorite(prod)" class="no-color-button">
                <ion-icon [name]="prod.isFav?'heart':'heart-outline'" [color]="prod.isFav?'primary':'dark'"
                  slot="icon-only"></ion-icon>
              </ion-button>
              <div class="btns">

                @if(prod.new){
                <span
                  [class]="(prod.offer&&prod.new)|| (prod.new&&prod.special)||(prod.special&& prod.offer)?'extra':'expanded'">
                  <ion-img src="../../../assets/imgs/stars.svg" slot="icon-only"></ion-img>
                  @if(!prod.special&&!prod.offer){جديد}
                </span>
                }
                @if(prod.offer){

                <span [class]="(prod.offer&&prod.new)|| (prod.new&&prod.special)||(prod.special&&
                  prod.offer)?'extra':'expanded'">
                  <ion-img src="../../../assets/imgs/offer-icon.svg" slot="icon-only"></ion-img>
                  @if(!prod.new&&!prod.special){خصم}
                </span>
                }
                @if(prod.special){
                <span [class]="(prod.offer&&prod.new)|| (prod.new&&prod.special)||(prod.special&&
                  prod.offer)?'extra':'expanded'">

                  <ion-img src="../../../assets/imgs/trend-icon.svg" slot="icon-only"></ion-img>
                </span>
                }
              </div>
            </div>
          </div>
          }


        </div>
      </div>

    </div>
    }
    @if(error){
    <p style="text-align: center;">{{errorMsg}}</p>
    }
  </div>

</ion-content>


<ion-footer *ngIf="!isloading">
  <div class="add-constract">
    <h3>{{product.price - product.discountPrice |number}} د.ع</h3>
    <ion-buttons slot="end">
      <ion-button (click)="product.quantity=product?.quantity -1" [disabled]="(product?.quantity<=1)">
        <ion-icon name="remove-outline"></ion-icon></ion-button>
      <span>{{product?.quantity}}</span>
      <ion-button (click)="product.quantity=product?.quantity +1"><ion-icon name="add-outline"></ion-icon></ion-button>
    </ion-buttons>
  </div>

  <div class="add-to-cart">
    <ion-button class="no-color-button" (click)="removeFromFavorite()">
      <ion-icon [name]="product?.isFav?'heart':'heart-outline'" [color]="product?.isFav?'danger':''"></ion-icon>
    </ion-button>
    <ion-button (click)="addToCart(this.product)">
      <ion-label>أضف للسلة</ion-label>
      <ion-img src="../../../assets/imgs/add-cart.svg"></ion-img>
    </ion-button>
  </div>

</ion-footer>
