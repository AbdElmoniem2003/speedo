<ion-header class="main-header">
  <ion-toolbar>
    <ion-button slot="start" class="ion-activatable no-color-button" (click)="navCtrl.navigateForward('notifications')">
      <ion-img slot="icon-only" src="../../../assets/imgs/bell.svg"></ion-img>
      <ion-ripple-effect></ion-ripple-effect>
    </ion-button>
    <ion-button slot="start" class="ion-activatable no-color-button cart" (click)="toCart()">
      @if((cartService.items?.length)){
      <span class="cart-counter">{{cartService.items?.length}}</span>
      }
      <ion-img slot="icon-only" src="../../../assets/imgs/cart.svg">
      </ion-img>
      <ion-ripple-effect></ion-ripple-effect>
    </ion-button>
    <ion-img slot="end" src="../../../assets/imgs/logo-icon.svg"></ion-img>
  </ion-toolbar>

</ion-header>


<ion-content>

  <div class="page-header">
    <div>
      <section>الرئيسية</section>
      <div class="filter">
        <ion-button class="no-color-button" [routerLink]="'/search-products'">
          <ion-img src="../../../assets/imgs/filter.svg" slot="icon-only"></ion-img>
        </ion-button>
        <ion-input [readonly]="true" (click)="toCustomSearch(null)" placeholder="...ابحث عن منتج">
          <ion-icon name="search-outline"></ion-icon>
        </ion-input>
      </div>

    </div>
  </div>

  <ion-refresher (ionRefresh)="refresh($event)" slot="fixed">
    <ion-refresher-content refreshingSpinner="bubbles"> </ion-refresher-content>
  </ion-refresher>


  <div class="container">
    @if(!error){

    <swiper-container class="swiper-container" autoplay='{"delay":2000,"disableOnInteraction":false}'
      [slidesPerView]="'auto'" [updateOnWindowResize]="true">
      @if (!isLoading) {
      @for (slide of sliders; track $index) {
      <swiper-slide [routerLink]="slide.product?'/product/'+slide.product:'/tabs/home'">
        <app-custom-image class="fade-in" [mainImg]="slide.image"
          [altImg]="'../../../assets/imgs/logo-cover.png'"></app-custom-image>
      </swiper-slide>
      }
      }@else {
      <swiper-slide>
        <ion-skeleton-text animated></ion-skeleton-text>
      </swiper-slide>
      }
      <div class="swiper-pagination"></div>
    </swiper-container>
    }


    <!-- Home Content Goes Here -->
    <div class="home-data">

      @if(!isLoading&&!empty&&!error){
      <div class="sections-cards" *ngIf="categories">
        <div class="header">
          <ion-button class="more no-color-button" (click)="toCustomComponent('categories')">
            المزيد
            <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
          </ion-button>
          <section>الأقسام</section>
        </div>


        <div class="section-content">
          <div>
            @for (category of categories; track $index) {
            <div class="fade-in" (click)="openRelatedView(category,'section')">
              <app-custom-image [mainImg]="category.image"></app-custom-image>
              <h3> {{category.name}}</h3>
            </div>
            }
          </div>


        </div>
      </div>

      <div class="most-demand" *ngIf="bestSeller">
        <div class="header">
          <ion-button class="more no-color-button" (click)="toCustomSearch({bestSeller:true})">
            المزيد
            <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
          </ion-button>
          <section>الأكثر طلبا</section>
        </div>



        <div class="demand-cards">
          @for (prod of bestSeller; track $index) {
          <div class="card fade-in">
            <div class="card-content" [routerLink]="'/product/'+prod._id">
              <app-custom-image [mainImg]="prod.image"></app-custom-image>
              <p>{{prod.name}}</p>
              <h3>{{prod.price}} د.ع</h3>
            </div>
            <ion-button (click)="addToCart(prod)" [disabled]="prod.inCart">
              <ion-label> {{prod.inCart?'في السلة':'أضف للسلة'}}</ion-label>
              <ion-img src="../../../assets/imgs/add-cart.svg"></ion-img>
            </ion-button>
            <div class="addition-btns">
              <ion-button (click)="addToFavorite(prod)" class="no-color-button">
                <ion-icon [name]="prod.isFav?'heart':'heart-outline'" [color]="prod.isFav?'primary':'dark'"
                  slot="icon-only"></ion-icon>
              </ion-button>
              <app-product-classes [prod]="prod"></app-product-classes>
            </div>
          </div>
          }
        </div>



      </div>

      <div class="offers" *ngIf="offers">

        <div class="header">
          <ion-button class="more no-color-button" (click)="toCustomComponent('offers')">
            المزيد
            <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
          </ion-button>
          <section>العروض</section>
        </div>

        <div class="offers-cards">
          @for (offer of offers; track $index) {
          <div class="card fade-in">
            <app-custom-image [mainImg]="offer.image"></app-custom-image>
            <ion-button class="no-color-button" [routerLink]="['/offer']" [queryParams]=" { id: offer._id} ">
              <ion-label>تفقد المنتجات</ion-label>
              <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
            </ion-button>
          </div>
          }
        </div>



      </div>

      <div class="discounts" *ngIf="discountProducts">
        <div class="header">
          <ion-button class="more no-color-button" (click)="toCustomSearch({discount:1})">
            المزيد
            <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
          </ion-button>
          <section>التخفيضات</section>
        </div>



        <div class="discount-cards">
          @for (discountProd of discountProducts; track $index) {
          <div class=" card fade-in">
            <div class="card-content" [routerLink]='"/product/" + discountProd._id'>
              <app-custom-image [mainImg]="discountProd.image"></app-custom-image>
              <p> {{discountProd.name}} </p>
              <h3>{{discountProd.price |number}} د.ع</h3>
            </div>
            <ion-button (click)="addToCart(discountProd)" [disabled]="discountProd.inCart">
              <ion-label> {{discountProd.inCart?'في السلة':'أضف للسلة'}}</ion-label>
              <ion-img src="../../../assets/imgs/add-cart.svg"></ion-img>
            </ion-button>
            <div class="addition-btns">
              <ion-button (click)="addToFavorite(discountProd)" class="no-color-button">
                <ion-icon [name]="discountProd.isFav?'heart':'heart-outline'"
                  [color]="discountProd.isFav?'primary':'dark'" slot="icon-only"></ion-icon>
              </ion-button>
              <app-product-classes [prod]="discountProd"></app-product-classes>

            </div>
          </div>
          }
        </div>


      </div>

      <div class="brands" *ngIf="brands">

        <div class="header">
          <ion-button class="more no-color-button" (click)="toCustomComponent('brands')">
            المزيد
            <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
          </ion-button>
          <section>البراندات</section>
        </div>


        <div class="brands-cards">
          <div>
            @for (brand of brands; track $index) {
            <div class="card fade-in" (click)="openRelatedView(brand,'brand')">
              <app-custom-image [mainImg]="brand.image"></app-custom-image>
            </div>
            }

          </div>

        </div>



      </div>

      <div class="recent" *ngIf="newProducts">

        <div class="header">
          <ion-button class="more no-color-button" (click)="toCustomSearch({new:true})">
            المزيد
            <ion-icon name="chevron-back-outline" slot="start"></ion-icon>
          </ion-button>
          <section>وصل حديثا</section>
        </div>


        <div class="recent-cards">
          @for (newProd of newProducts; track $index) {
          <div class="card fade-in">
            <div class="card-content" [routerLink]="`/product/${newProd._id}`">
              <app-custom-image [mainImg]="newProd.image"></app-custom-image>
              <p> {{newProd.name}}</p>
              <h3>{{newProd.price|number}} د.ع</h3>
            </div>
            <ion-button (click)="addToCart(newProd)" [disabled]="newProd.inCart">
              <ion-label> {{newProd.inCart?'في السلة':'أضف للسلة'}}</ion-label>
              <ion-img src="../../../assets/imgs/add-cart.svg"></ion-img>
            </ion-button>

            <div class="addition-btns">
              <ion-button (click)="addToFavorite(newProd)" class="no-color-button">
                <ion-icon [name]="newProd.isFav?'heart':'heart-outline'" [color]="newProd.isFav?'primary':'dark'"
                  slot="icon-only"></ion-icon>
              </ion-button>
              <app-product-classes [prod]="newProd"></app-product-classes>

            </div>
          </div>
          }

        </div>



      </div>
      }

      @if(isLoading){
      <div class="sections-cards">
        <div class="header" *ngIf="isLoading"> <ion-skeleton-text animated></ion-skeleton-text></div>
        <div class="section-content">

          <div *ngIf="isLoading">
            <ion-skeleton-text animated="true" *ngFor="let i of [1,2,3,4,5,6,7,8,1,2,3,4,5,6,7,8]"></ion-skeleton-text>
          </div>
        </div>
      </div>

      <div class="most-demand">

        <div *ngIf="isLoading" class="header"><ion-skeleton-text animated></ion-skeleton-text></div>

        <div class="demand-cards" *ngIf="isLoading">
          <ion-skeleton-text animated *ngFor="let i of [1,2,3,4,5,6,7,8]" style="min-width: 167px;"></ion-skeleton-text>
        </div>
      </div>

      <div class="offers">
        <div class="header" *ngIf="isLoading"><ion-skeleton-text animated></ion-skeleton-text></div>
        <div class="offers-cards" *ngIf="isLoading">
          <ion-skeleton-text class="card" *ngFor="let i of [1,2]"></ion-skeleton-text>
        </div>
      </div>

      <div class="discounts">
        <div class="header" *ngIf="isLoading"><ion-skeleton-text animated=""></ion-skeleton-text>
        </div>
        <div class="discount-cards" *ngIf="isLoading"><ion-skeleton-text *ngFor="let i of [1,2,3,4,5,6,7,8]" animated=""
            style="min-width: 167px;"></ion-skeleton-text></div>
      </div>

      <div class="brands">
        <div class="header" *ngIf="isLoading"><ion-skeleton-text animated=""></ion-skeleton-text>
        </div>
        <div class="brands-cards" *ngIf="isLoading">
          <div>
            <ion-skeleton-text class="card" animated=""
              *ngFor="let i of [1,2,3,4,5,6,7,8,1,2,3,4,5,6,7,8]"></ion-skeleton-text>
          </div>
        </div>
      </div>

      <div class="recent">
        <div class="header" *ngIf="isLoading"><ion-skeleton-text animated=""></ion-skeleton-text>
        </div>
        <div class="recent-cards" *ngIf="isLoading">
          <ion-skeleton-text class="card" animated="" *ngFor="let i of [1,2,3,4,5,6,7,8]"
            style="min-width: 167px;"></ion-skeleton-text>
        </div>
      </div>
      }
    </div>


    @if(error){
    <div style="padding: 16px; text-align: center;">
      <ion-icon src="../../../assets/imgs/logo-icon.svg" style="font-size: 50px;"></ion-icon>
      <h3> برجاء التحقق من الشبكة و إعادة المحاولة</h3>
    </div>
    }
  </div>

</ion-content>